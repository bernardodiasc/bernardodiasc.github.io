<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name="viewport"><meta content="#000000" name="theme-color"><link href="/manifest.json" rel="manifest"><link href="/favicon.ico" rel="shortcut icon"><title>How to include a sitemap.xml in a create-react-app site - Bernardo Dias da Cruz</title><link href="/styles/main.css" rel="stylesheet"><link href="/static/css/main.183ad9be.css" rel="stylesheet"><link href="https://www.googletagmanager.com" rel="preconnect"><link href="https://fonts.googleapis.com" rel="preconnect"><link href="https://fonts.googleapis.com" rel="preconnect"><link href="https://fonts.googleapis.com" rel="preconnect"><link href="/" rel="canonical" data-react-helmet="true"><meta content="@bernardodiasc" data-react-helmet="true" name="twitter:site"><meta content="How to include a sitemap.xml in a create-react-app site - Bernardo Dias da Cruz" data-react-helmet="true" name="twitter:title"><meta content="@bernardodiasc" data-react-helmet="true" name="twitter:creator"><meta content="/images/thumbnail.png" data-react-helmet="true" name="twitter:image"><meta content="How to include a sitemap.xml in a create-react-app site - Bernardo Dias da Cruz" data-react-helmet="true" property="og:title"><meta content="article" data-react-helmet="true" property="og:type"><meta content="http://bernardodiasdacruz.com/" data-react-helmet="true" property="og:url"><meta content="/images/thumbnail.png" data-react-helmet="true" property="og:image"><meta content="Bernardo Dias da Cruz" data-react-helmet="true" property="og:site_name"><link href="https://fonts.gstatic.com" rel="preconnect"><link href="https://fonts.gstatic.com" rel="preconnect"><link href="https://fonts.gstatic.com" rel="preconnect"><link href="https://bernardodiasc.disqus.com" rel="preconnect"><link href="https://c.disquscdn.com/next/embed/styles/lounge.afe8bc0f134a77a505cf2ee26c56a3a9.css" rel="preload" as="style"><link href="https://c.disquscdn.com/next/embed/common.bundle.774abcf1e2c32f6ee53499b090f48ff0.js" rel="preload" as="script"><link href="https://c.disquscdn.com/next/embed/lounge.bundle.8241ae5fc761eb94635acdc63f5fd29f.js" rel="preload" as="script"><link href="https://disqus.com/next/config.js" rel="preload" as="script"><link href="https://disqus.com" rel="preconnect"><link href="https://c.disquscdn.com" rel="preconnect"><script src="https://c.disquscdn.com/next/embed/alfalfa.4a5fcca1fe50a757044dfd331b660625.js" async charset="UTF-8"></script><link href="https://ssl.google-analytics.com" rel="preconnect"><link href="https://connect.facebook.net" rel="preconnect"><link href="http://cdn.viglink.com" rel="preconnect"><link href="https://apis.google.com" rel="preconnect"><link href="https://staticxx.facebook.com" rel="preconnect"><link href="https://www.facebook.com" rel="preconnect"><link href="https://links.services.disqus.com" rel="preconnect"><link href="http://links.services.disqus.com" rel="preconnect"><link href="https://accounts.google.com" rel="preconnect"><link href="https://ssl.gstatic.com" rel="preconnect"><link href="https://glitter.services.disqus.com" rel="preconnect"><link href="https://referrer.disqus.com" rel="preconnect"><link href="https://pippio.com" rel="preconnect"><link href="https://tags.bluekai.com" rel="preconnect"><link href="/static/js/main.5c63347b.js" rel="preload" as="script"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><main class="Layout"><header class="Layout__header"><h1 class="Layout__header-title"><a aria-current="false" class="AppLink" href="/">Random Thoughts</a></h1><ul class="Layout-Tabs"><li class="Layout-Tabs__tab"><a aria-current="false" class="AppLink Layout-Tabs__link" href="/" title="Latest posts"><svg class="Icon" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3l-10-9-10 9h3v8z"></path></svg></a></li><li class="Layout-Tabs__tab"><a aria-current="false" class="AppLink Layout-Tabs__link" href="/search" title="Search for content"><svg class="Icon" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M12 10.9c-.61 0-1.1.49-1.1 1.1s.49 1.1 1.1 1.1c.61 0 1.1-.49 1.1-1.1s-.49-1.1-1.1-1.1zm0-8.9c-5.52 0-10 4.48-10 10s4.48 10 10 10 10-4.48 10-10-4.48-10-10-10zm2.19 12.19l-8.19 3.81 3.81-8.19 8.19-3.81-3.81 8.19z"></path></svg></a></li><li class="Layout-Tabs__tab"><a aria-current="false" class="AppLink Layout-Tabs__link" href="/archive" title="Content archive"><svg class="Icon" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M19,19H5V8H19M16,1V3H8V1H6V3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3H18V1M17,12H12V17H17V12Z"></path></svg></a></li><li class="Layout-Tabs__tab"><a aria-current="false" class="AppLink Layout-Tabs__link" href="/about-me" title="About me"><svg class="Icon" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M21,13A9,9 0 0,1 12,22A9,9 0 0,1 3,13L3.03,4.43C5.68,2.88 8.76,2 12.05,2C15.3,2 18.36,2.87 21,4.38V13M13,19.93C16.39,19.44 19,16.5 19,13V5.59C16.9,4.57 14.54,4 12.05,4C9.5,4 7.08,4.6 4.94,5.66L5,13C5,16.5 7.63,19.44 11,19.93V18H13V19.93M11,16H8L6,13L9,14H10L11,13H13L14,14H15L18,13L16,16H13L12,15L11,16M6,9.03C6.64,8.4 7.5,8.05 8.5,8.05C9.45,8.05 10.34,8.4 11,9.03C10.34,9.65 9.45,10 8.5,10C7.5,10 6.64,9.65 6,9.03M13,9.03C13.64,8.4 14.5,8.05 15.5,8.05C16.45,8.05 17.34,8.4 18,9.03C17.34,9.65 16.45,10 15.5,10C14.5,10 13.64,9.65 13,9.03Z"></path></svg></a></li></ul></header><article class="Layout__content"><div class="Layout__content-inner"><div class="PostDetails"><div class="PostHeader PostHeader--details"><p class="PostHeader__category"><a aria-current="false" class="AppLink PostHeader__category-link" href="/category/this-blog"><span class="PostHeader__icon"><svg class="Icon" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M22,9V7H20V5A2,2 0 0,0 18,3H4A2,2 0 0,0 2,5V19A2,2 0 0,0 4,21H18A2,2 0 0,0 20,19V17H22V15H20V13H22V11H20V9H22M18,19H4V5H18V19M6,13H11V17H6V13M12,7H16V10H12V7M6,7H11V12H6V7M12,11H16V17H12V11Z"></path></svg></span>This blog development process</a></p><h1 class="PostHeader__title">How to include a sitemap.xml in a create-react-app site</h1><p class="PostHeader__meta">Friday March 16th, 2018</p></div><div class="TextBlock"><p>This blog is evolving and its content is getting bigger. It's still hosted on GitHub pages, even though it's DNS now points to a custom domain.</p><p>SEO was one reason that weighted on the custom domain move. Well, it also looks better to have a custom domain. Anyway, for the SEO aspects, I also included pre-rendering feature and head meta tags. Both things that could have a dedicated post for each one.</p><p>What I'm going to explain here is how I included a <code>sitemap.xml</code> file on this site. This is a <code>create-react-app</code> based project, therefore the implementation is somehow affected by that library defaults.</p><p>The solution was to create a script that would generate the sitemap file, and this script is included in the build task.</p><h2 id="the-how-to">The how to</h2><p>Alright, first things first. My CRA setup was using default Babel configuration, and because of that I haven't installed nor configured Babel for this project previously. I could write my generator script in plain old JS, but there were some main concerns preventing me to do that:</p><p>One concern is that I wanted to use the existing selector methods to iterate the content, for the content-based pages, and they were already written with latest JS features.</p><p>The other concern was that I simply wanted to write the script with modern JS.</p><h3 id="setup-babel">Setup Babel</h3><p>Install all the requirements:</p><pre><code>yarn add babel-cli babel-preset-env babel-preset-stage-0 babel-preset-react --dev
</code></pre><p>Create a <code>.babelrc</code> file in the root:</p><pre><code>{
  "presets": ["env", "react", "stage-0"]
}
</code></pre><p>That's it, Babel is ready and we can move forward to our modern JS script!</p><p>References:</p><ul><li><a href="https://babeljs.io/docs/usage/cli/">https://babeljs.io/docs/usage/cli/</a></li><li><a href="https://babeljs.io/docs/plugins/">https://babeljs.io/docs/plugins/</a></li><li><a href="https://babeljs.io/docs/usage/babelrc/">https://babeljs.io/docs/usage/babelrc/</a></li></ul><h3 id="create-the-sitemap-generator-script">Create the sitemap generator script</h3><p>To create the sitemap XML I used <a href="https://github.com/ekalinin/sitemap.js">https://github.com/ekalinin/sitemap.js</a>, it's quite simple and the instructions in the README are quite good for many different cases.</p><pre><code>yarn add sitemap --dev
</code></pre><p>The script looks like this:</p><pre><code>import path from 'path'
import sm from 'sitemap'
import fs from 'fs'

import config from '.'
import data from '../data.json'
import {
  getAllPostsForListing,
  getAllCategoriesForListing,
} from '../selectors/data'

const OUTPUT_FILE = path.resolve(__dirname, '..', '..', 'public', 'sitemap.xml')

const postsUrls = getAllPostsForListing({data})
  .map(post => ({
    url: `${config.PUBLIC_URL}/${post.handle}`,
    changefreq: 'weekly',
    priority: 0.8,
  }))

const categoriesUrls = getAllCategoriesForListing({data})
  .map(category => ({
    url: `${config.PUBLIC_URL}/category/${category.handle}`,
    changefreq: 'weekly',
    priority: 0.8,
  }))

const sitemap = sm.createSitemap({
    hostname: '<a class="vglnk" href="http://bernardodiasdacruz.com" rel="nofollow"><span>http</span><span>://</span><span>bernardodiasdacruz</span><span>.</span><span>com</span></a>',
    cacheTime: 600000, //600 sec (10 min) cache purge period
    urls: [
      { url: '/', changefreq: 'weekly', priority: 1 },
      { url: '/archive', changefreq: 'weekly', priority: 0.5 },
      { url: '/search', changefreq: 'weekly', priority: 0.5 },
      { url: '/about-me', changefreq: 'monthly', priority: 0.5 },
      ...postsUrls,
      ...categoriesUrls,
    ]
})

fs.writeFileSync(OUTPUT_FILE, sitemap.toString())

console.log(`Sitemap written at ${OUTPUT_FILE}`)
</code></pre><p>Yeah, I know many resources out there suggests that I load a <code>routes</code> file and iterate with it. You could really go for that approach if you'd prefer. By reading the script above I hope you get the idea of the how to. In my opinion, since this is a fairly small project, hardcoding the pages of the sitemap is good enough.</p><h3 id="workflow">Workflow</h3><p>On <code>package.json</code> script, I included a new task called <code>sitemap</code> and appended it in the <code>prebuild</code> task, see:</p><pre><code>"sitemap": "./node_modules/.bin/babel-node src/config/sitemap.js",
"prebuild": "npm run content && npm run sitemap",
</code></pre><h3 id="the-final-round">The final round</h3><p>After making the commit and deploy of these changes, I went to <a href="https://www.google.com/webmasters/">https://www.google.com/webmasters/</a> and tested the sitemap there, successfully. Check out the result <a href="http://bernardodiasdacruz.com/sitemap.xml">http://bernardodiasdacruz.com/sitemap.xml</a>.</p><p>This solution was integrated on this website in this <a href="https://github.com/bernardodiasc/bernardodiasc.github.io/commit/0d7f2f457db38512d8392621d1e31935afcf4039">commit</a>.</p></div></div><div class="Disqus"><div id="disqus_thread"><iframe id="dsq-app5566" name="dsq-app5566" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="https://disqus.com/embed/comments/?base=default&f=bernardodiasc&t_i=2018-03-16-how-to-include-a-sitemap-in-a-create-react-app-site&t_u=http%3A%2F%2Flocalhost%3A45678%2F2018%2F03%2F16%2Fhow-to-include-a-sitemap-in-a-create-react-app-site&t_e=How%20to%20include%20a%20sitemap.xml%20in%20a%20create-react-app%20site&t_d=How%20to%20include%20a%20sitemap.xml%20in%20a%20create-react-app%20site&t_t=How%20to%20include%20a%20sitemap.xml%20in%20a%20create-react-app%20site&s_o=default#version=3e91f895da97667a42583677a655c093" style="width:1px!important;min-width:100%!important;border:none!important;overflow:hidden!important;height:467px!important" horizontalscrolling="no" verticalscrolling="no"></iframe><iframe id="indicator-north" name="indicator-north" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" style="width:355px!important;border:none!important;overflow:hidden!important;top:0!important;min-width:355px!important;max-width:355px!important;position:fixed!important;z-index:2147483646!important;height:18px!important;min-height:18px!important;max-height:18px!important;display:none!important"></iframe><iframe id="indicator-south" name="indicator-south" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" style="width:355px!important;border:none!important;overflow:hidden!important;bottom:0!important;min-width:355px!important;max-width:355px!important;position:fixed!important;z-index:2147483646!important;height:18px!important;min-height:18px!important;max-height:18px!important;display:none!important"></iframe></div></div></div></article></main></div><script src="https://www.googletagmanager.com/gtag/js?id=UA-10219275-4" async></script><script>if("localhost"!==window.location.hostname){function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-10219275-4")}</script><script src="/static/js/main.5c63347b.js" type="text/javascript"></script><script src="https://bernardodiasc.disqus.com/embed.js" async id="dsq-embed-scr"></script><iframe style="display:none"></iframe></body></html>