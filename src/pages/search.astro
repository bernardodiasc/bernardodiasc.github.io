---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import PageContent from '../components/PageContent.astro';
import TextBlock from '../components/TextBlock.astro';

const posts = await getCollection('posts', ({ data }) => !data.draft);
const categories = await getCollection('categories');

const allCategories = [...new Set(posts.map((p) => p.data.category).filter(Boolean))];
const allTags = [...new Set(posts.flatMap((p) => p.data.tags))].sort();
---

<Layout title="Filter content">
  <PageContent>
    <TextBlock>
      {allCategories.length > 0 && (
        <nav>
          <h3>Categories</h3>
          <ul>
            {allCategories.map((cat) => {
              const catData = categories.find((c) => c.id === cat);
              return (
                <li>
                  <a href={`/category/${cat}`}>{catData?.data.title || cat}</a>
                </li>
              );
            })}
          </ul>
        </nav>
      )}

      {allTags.length > 0 && (
        <nav>
          <h3>Tags</h3>
          <ul>
            {allTags.map((tag) => (
              <li>{tag}</li>
            ))}
          </ul>
        </nav>
      )}
    </TextBlock>
  </PageContent>
</Layout>
